<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tendor ‚Äî Find Local Help Fast</title>
  <meta name="description" content="Tendor matches neighbors with local freelancers (students & community pros) for quick gigs ‚Äî lawn care, tutoring, moving help, pet sitting and more." />
  <meta name="theme-color" content="#ff6b6b" />
  <!-- PWA: manifest & iOS meta -->
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="/icons/icon-192.png" />
  <style>
    /* --- Reset / base --- */
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;line-height:1.5;color:#0b1220;background:var(--bg)}
    img{max-width:100%;display:block}
    a{text-decoration:none;color:inherit}
    button{font:inherit}

    /* --- Bright Theme --- */
    :root{
      --bg:#fff7ed;             /* warm paper */
      --panel:#ffffff;          /* cards/nav */
      --panel-2:#fff0dc;        /* subtle */
      --text:#0b1220;           /* primary text */
      --muted:#475569;          /* secondary text */
      --brand:#ff4d6d;          /* coral */
      --brand-2:#ffb703;        /* amber */
      --accent:#06d6a0;         /* mint */
      --ok:#22c55e;             /* green */
      --danger:#ef4444;         /* red */
      --ring:rgba(255,109,109,.35);
      --shadow:0 12px 32px rgba(2,6,23,.15);
      --radius:16px;
    }

    .gradient-bg{background:
      radial-gradient(1000px 500px at 70% -10%, rgba(255,109,109,.18), transparent 60%),
      radial-gradient(800px 400px at 0% 0%, rgba(255,183,3,.18), transparent 60%),
      linear-gradient(180deg,#fff7ed 0%, #fff7ed 100%)}

    /* --- Layout --- */
    .container{width:min(1100px,92vw);margin-inline:auto}
    header{position:sticky;top:0;z-index:30;background:rgba(255,255,255,.7);backdrop-filter:blur(10px);border-bottom:1px solid rgba(2,6,23,.06)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 10px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.2px}
    .logo-mark{width:34px;height:34px;border-radius:9px;background:conic-gradient(from 210deg,var(--brand),var(--brand-2),var(--accent));box-shadow:0 6px 18px rgba(255,77,109,.35)}
    .logo span{font-size:18px}
    .nav-actions{display:flex;gap:10px;align-items:center}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid rgba(2,6,23,.08);color:#0b1220;background:linear-gradient(180deg,#fff,#fff);cursor:pointer;transition:.2s box-shadow,.2s transform}
    .btn:hover{box-shadow:var(--shadow);transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(180deg,var(--brand),var(--brand-2));color:#081018;font-weight:800;border:none}
    .btn.ghost{background:transparent}
    .role-badge{padding:6px 10px;border-radius:999px;background:rgba(6,214,160,.16);border:1px solid rgba(6,214,160,.35);font-weight:700;}

    /* --- Screens --- */
    .screen{display:none}
    .screen.active{display:block}

    /* --- Landing (marketing first) --- */
    .landing .hero{position:relative;overflow:hidden}
    .hero-inner{display:grid;grid-template-columns:1.1fr .9fr;gap:26px;align-items:center;padding:40px 10px 26px}
    @media (max-width: 900px){.hero-inner{grid-template-columns:1fr;padding:28px 10px}}
    .eyebrow{display:inline-block;margin-bottom:8px;padding:6px 10px;border-radius:999px;background:rgba(255,77,109,.12);border:1px solid rgba(255,77,109,.35);font-weight:800;color:#a4161a}
    .headline{font-size:clamp(28px,5.2vw,56px);line-height:1.05;margin:0;background:linear-gradient(180deg,#111827,#334155);-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:900}
    .subhead{color:#334155;font-size:clamp(15px,2.2vw,18px);margin:14px 0 22px;max-width:700px}
    .hero-card{background:var(--panel);border:1px solid rgba(2,6,23,.08);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
    .hero-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media (max-width: 520px){.hero-grid{grid-template-columns:1fr}}

    .section{padding:28px 10px}
    .section h2{margin:0 0 6px;font-size:clamp(22px,3.6vw,32px);}
    .section p.lead{margin:0 0 18px;color:#334155}
    .panel{background:var(--panel);border:1px solid rgba(2,6,23,.08);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}

    .features{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width: 900px){.features{grid-template-columns:1fr}}
    .feature{border-radius:16px;background:var(--panel);border:1px solid rgba(2,6,23,.08);padding:16px}
    .feature h4{margin:0 0 6px}
    .feature p{margin:0;color:#334155}

    .logos{display:flex;gap:18px;flex-wrap:wrap;align-items:center; opacity:.85}
    .logos .pill{padding:10px 14px;border:1px dashed rgba(2,6,23,.12);border-radius:12px;background:#fff;color:#334155}

    /* --- App: Auth minimal --- */
    .auth{min-height:calc(100dvh - 64px);display:grid;place-items:center;padding:20px}
    .card{background:var(--panel);border:1px solid rgba(2,6,23,.06);border-radius:20px;box-shadow:var(--shadow)}
    .auth .card{width:min(520px,95vw);padding:18px}
    .label{display:block;color:#0b1220;margin:8px 0 4px;font-weight:600}
    .field{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(2,6,23,.12);background:#fff;color:#0b1220}
    .tabs{display:flex;gap:8px;margin-bottom:10px}
    .tab{flex:1;text-align:center;padding:10px;border-radius:12px;border:1px solid rgba(2,6,23,.12);cursor:pointer;background:#fff;font-weight:700}
    .tab.active{border-color:rgba(255,77,109,.6);box-shadow:0 0 0 4px var(--ring)}

    /* Swipe deck (customer), board (worker) reused from earlier */
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:14px}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .search{flex:1;min-width:220px}
    .input{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(2,6,23,.12);background:#fff;color:#0b1220}

    .deck-wrap{display:grid;grid-template-columns:1fr;gap:12px;align-items:center}
    .deck{position:relative;height:480px;border-radius:20px;overflow:visible}
    @media (max-width: 520px){.deck{height:420px}}
    .tcard{position:absolute;inset:0;margin:auto;width:min(520px,100%);height:100%;border-radius:20px;background:#fff;border:1px solid rgba(2,6,23,.12);box-shadow:0 20px 50px rgba(2,6,23,.15);padding:0;touch-action:none;user-select:none}
    .tcard.hidden{display:none}
    .card-header{position:relative;height:56%;border-bottom:1px solid rgba(2,6,23,.08);display:flex;align-items:center;justify-content:center;overflow:hidden;border-top-left-radius:20px;border-top-right-radius:20px}
    .avatar{width:100%;height:100%;background:conic-gradient(from 180deg at 50% 50%,#ffe08a,#ff4d6d,#06d6a0,#ffd166);opacity:.9}
    .badge{position:absolute;top:12px;left:12px;padding:6px 10px;border-radius:999px;font-weight:700;color:#081018;letter-spacing:.2px;box-shadow:0 8px 18px rgba(0,0,0,.08)}
    .badge.ok{background:#bbf7d0}
    .badge.new{background:#fde68a}
    .price{position:absolute;bottom:12px;right:12px;background:#fff;border:1px solid rgba(2,6,23,.12);color:#0b1220;border-radius:12px;padding:6px 10px}
    .card-body{padding:14px 14px 16px}
    .title{display:flex;align-items:center;gap:10px}
    .title h3{margin:0;font-size:22px}
    .rating{color:#efb01b;font-weight:800}
    .meta{display:flex;gap:10px;color:#0ea5e9;flex-wrap:wrap}
    .meta .dot{width:4px;height:4px;border-radius:50%;background:#94a3b8;display:inline-block}
    .skills{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .skills .pill{padding:6px 10px;border-radius:999px;background:#fff7ed;border:1px solid rgba(2,6,23,.12)}
    .bio{color:#0b1220}
    .card-actions{display:flex;gap:14px;justify-content:center;margin-top:14px}
    .circle-btn{width:60px;height:60px;border-radius:50%;border:none;cursor:pointer;display:grid;place-items:center;font-size:22px;font-weight:900;color:#081018}
    .circle-btn.no{background:var(--danger)}
    .circle-btn.yes{background:var(--ok)}
    .hint{color:#334155;text-align:center;margin-top:8px}

    .matches{margin-top:14px}
    .match-item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px;border-radius:12px;border:1px solid rgba(2,6,23,.12);background:#fff}
    .mini{width:36px;height:36px;border-radius:10px;background:linear-gradient(180deg,var(--brand),var(--brand-2))}

    .board{display:grid;grid-template-columns:1fr;gap:10px}
    .job{display:flex;justify-content:space-between;gap:12px;align-items:center;padding:12px;border-radius:14px;border:1px solid rgba(2,6,23,.12);background:#fff}
    .job h4{margin:0}

    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,.25);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
    .modal{width:min(720px,96vw);background:var(--panel);border:1px solid rgba(2,6,23,.12);border-radius:18px;box-shadow:var(--shadow);padding:16px}
    .modal h3{margin-top:0}
    .modal-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width: 720px){.modal-grid{grid-template-columns:1fr}}

    .toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:#111827;color:white;padding:12px 16px;border-radius:12px;display:none;z-index:60}

    footer{margin-top:28px;border-top:1px solid rgba(2,6,23,.06)}
    .foot{padding:18px 10px;color:#334155;display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px}

    .hidden{display:none!important}
  </style>
</head>
<body class="gradient-bg">
  <header>
    <div class="container nav">
      <a class="logo" href="#home" aria-label="Tendor home">
        <div class="logo-mark" aria-hidden="true"></div>
        <span>Tendor</span>
      </a>
      <nav class="nav-actions">
        <span id="roleBadge" class="role-badge hidden"></span>
        <button class="btn" id="launch-app">Open App</button>
        <a class="btn ghost" href="#how">How it works</a>
        <button class="btn" id="open-post">Post a Job</button>
        <button class="btn primary" id="open-join">Become a Freelancer</button>
      </nav>
    </div>
  </header>

  <!-- LANDING (first screen) -->
  <main id="screen-landing" class="screen landing active">
    <section class="hero" id="home">
      <div class="container hero-inner">
        <div>
          <span class="eyebrow">BRIGHT ‚Ä¢ FAST ‚Ä¢ LOCAL</span>
          <h1 class="headline">Find local help in seconds ‚Äî swipe, match, done.</h1>
          <p class="subhead">Tendor is a community marketplace that feels like Tinder, built for real‚Äëworld jobs: lawn care, dog walking, tutoring, moving help, snow shoveling and more.</p>
          <div class="hero-grid" style="margin-top:18px">
            <div class="hero-card">
              <h4>Why Tendor?</h4>
              <div class="logos">
                <span class="pill">‚ö° Instant matching</span>
                <span class="pill">üìç Local first</span>
                <span class="pill">üõ°Ô∏è Verified</span>
                <span class="pill">üí¨ In‚Äëapp chat</span>
              </div>
              <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap">
                <button class="btn primary" id="cta-open-app">Get the App</button>
                <button class="btn" id="cta-browse">Browse freelancers</button>
              </div>
            </div>
            <div class="hero-card">
              <h4>What you can hire today</h4>
              <div class="logos">
                <span class="pill">üåø Lawn mowing</span>
                <span class="pill">üê∂ Dog walking</span>
                <span class="pill">üìö Tutoring</span>
                <span class="pill">üì¶ Moving help</span>
                <span class="pill">üß∞ Handyman</span>
              </div>
            </div>
          </div>
        </div>
        <div class="panel" aria-label="App preview" style="border-radius:20px;position:relative;overflow:hidden">
          <img alt="Preview" src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='900' height='700'><defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='%23ff4d6d'/><stop offset='1' stop-color='%23ffb703'/></linearGradient></defs><rect width='100%' height='100%' fill='%23fff7ed'/><g opacity='0.25'><circle cx='250' cy='120' r='160' fill='url(%23g)'/><circle cx='650' cy='200' r='200' fill='url(%23g)'/></g><g fill='%23111827' font-family='Arial' font-size='32' font-weight='700'><text x='60' y='90'>Swipe ‚ñ∂ Match ‚ñ∂ Hire</text></g><g fill='%23334155' font-family='Arial' font-size='20'><text x='60' y='140'>Below is how the app feels.</text></g></svg>"/>
        </div>
      </div>
    </section>

    <section class="section" id="how">
      <div class="container">
        <h2>How it works</h2>
        <p class="lead">Three steps to finished.</p>
        <div class="features">
          <div class="feature"><h4>1) Post or browse</h4><p>List your job with a budget, or browse nearby freelancers.</p></div>
          <div class="feature"><h4>2) Swipe to shortlist</h4><p>Swipe right to match, left to pass. Chat once matched.</p></div>
          <div class="feature"><h4>3) Book & review</h4><p>Clear rates, secure pay, and reviews to keep quality high.</p></div>
        </div>
        <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn primary" id="open-app-2">Open the App</button>
          <button class="btn" id="open-join-2">Join as Freelancer</button>
        </div>
      </div>
    </section>
  </main>

  <!-- AUTH (APP HOME: minimal) -->
  <main id="screen-auth" class="screen auth">
    <div class="card">
      <div class="tabs">
        <div class="tab active" data-tab="create">Create Account</div>
        <div class="tab" data-tab="signin">Sign In</div>
      </div>
      <form id="createForm">
        <label class="label" for="cEmail">Email</label>
        <input class="field" id="cEmail" type="email" placeholder="you@example.com" required />
        <label class="label" for="cPass">Password</label>
        <input class="field" id="cPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
        <button class="btn primary" type="submit" style="margin-top:12px">Create account</button>
      </form>
      <form id="signForm" class="hidden">
        <label class="label" for="sEmail">Email</label>
        <input class="field" id="sEmail" type="email" placeholder="you@example.com" required />
        <label class="label" for="sPass">Password</label>
        <input class="field" id="sPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
        <button class="btn primary" type="submit" style="margin-top:12px">Sign in</button>
      </form>
    </div>
  </main>

  <!-- ROLE SELECT (after auth) -->
  <main id="screen-role" class="screen auth">
    <div class="card" style="text-align:center">
      <h3 style="margin:8px 0 6px">What do you want to do?</h3>
      <p style="color:#334155;margin-top:0">Choose your experience.</p>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <button class="btn" id="chooseCustomer">I want to hire</button>
        <button class="btn primary" id="chooseWorker">I want to earn</button>
      </div>
    </div>
  </main>

  <!-- CUSTOMER ROUTE -->
  <main id="screen-customer" class="screen hidden">
    <section class="section" id="demo">
      <div class="container">
        <h2>Browse freelancers</h2>
        <p class="lead">Filter by category, search skills, then swipe left (‚úñ) to pass or right (‚úî) to match. Your matches are saved below.</p>
        <div class="panel">
          <div class="toolbar">
            <div class="chips" id="category-chips" aria-label="Categories"></div>
            <div class="search"><input id="search" class="input" type="search" placeholder="Search skills, e.g. 'math', 'snow', 'dog'" aria-label="Search"/></div>
          </div>
          <div class="deck-wrap">
            <div class="deck" id="deck" aria-live="polite"></div>
            <div class="card-actions">
              <button class="circle-btn no" id="btn-no" title="Pass">‚úñ</button>
              <button class="circle-btn yes" id="btn-yes" title="Match">‚úî</button>
            </div>
            <div class="hint">Tip: drag the top card left/right or use the buttons</div>
          </div>
        </div>
        <div class="matches" id="matches"></div>
      </div>
    </section>
  </main>

  <!-- WORKER ROUTE -->
  <main id="screen-worker" class="screen hidden">
    <section class="section">
      <div class="container">
        <h2>Nearby jobs</h2>
        <p class="lead">Accept jobs you want. Customers will be notified instantly.</p>
        <div class="panel">
          <div id="jobBoard" class="board"></div>
        </div>
        <div class="panel" style="margin-top:12px">
          <h3 style="margin-top:0">My accepted jobs</h3>
          <div id="myJobs" class="board"></div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container foot">
      <div>¬© <span id="year"></span> Tendor.</div>
      <div><a class="link" href="#" id="privacy-link">Privacy</a> ¬∑ <a class="link" href="#" id="terms-link">Terms</a></div>
    </div>
  </footer>

  <!-- Post a Job Modal -->
  <div class="modal-backdrop" id="post-modal">
    <!-- (unchanged modal content) -->
  </div>

  <!-- Join Modal -->
  <div class="modal-backdrop" id="join-modal">
    <!-- (unchanged modal content) -->
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // ---------- DATA & STORE ----------
    const DEFAULT_CATEGORIES = ['Lawn Care','Dog Walking','Tutoring','Moving Help','Snow Removal','Handyman','Cleaning','Baby Sitting','Tech Help','Photography'];
    const DEFAULT_PROFILES = [
      { id:'p1', name:'Ava R.', category:'Lawn Care', rate:28, rating:4.9, distance:2, skills:['mowing','edging','leaf cleanup'], bio:'Fast, reliable lawn care. Bring my own equipment.', photo:'', new:true },
      { id:'p2', name:'Miguel S.', category:'Moving Help', rate:30, rating:4.8, distance:4, skills:['lifting','packing','truck'], bio:'Two‚Äëperson team available evenings & weekends.', photo:'', verified:true },
      { id:'p3', name:'Kayla T.', category:'Tutoring', rate:35, rating:5.0, distance:1, skills:['algebra','calculus','SAT'], bio:'MSU math major ‚Äî patient & results‚Äëdriven.', photo:'', verified:true },
      { id:'p4', name:'Jamal B.', category:'Dog Walking', rate:22, rating:4.7, distance:3, skills:['walks','potty breaks','overnights'], bio:'Big‚Äëdog friendly. Flexible mornings.', photo:'', new:true },
      { id:'p5', name:'Priya N.', category:'Tech Help', rate:25, rating:4.9, distance:2, skills:['wifi','printer','phone setup'], bio:'I fix confusing tech in plain English.', photo:'', verified:true },
      { id:'p6', name:'Noah K.', category:'Snow Removal', rate:35, rating:4.8, distance:5, skills:['shoveling','salting','driveways'], bio:'On‚Äëcall during storms. Text me early!', photo:'', verified:true },
      { id:'p7', name:'Lena G.', category:'Cleaning', rate:32, rating:4.9, distance:2, skills:['deep clean','kitchens','bathrooms'], bio:'Sparkling clean, supplies included.', photo:'', verified:true },
      { id:'p8', name:'Drew P.', category:'Handyman', rate:45, rating:4.8, distance:8, skills:['mounting','furniture','repairs'], bio:'Small jobs done right the first time.', photo:'', verified:true },
      { id:'p9', name:'Sara W.', category:'Photography', rate:60, rating:4.9, distance:6, skills:['portraits','events','editing'], bio:'Clean, modern style. Quick turnaround.', photo:'', new:true },
    ];

    const store = { get(k,f){ try{return JSON.parse(localStorage.getItem(k)) ?? f }catch{ return f } }, set(k,v){ localStorage.setItem(k, JSON.stringify(v)) } }

    let categories = store.get('tendor_categories', DEFAULT_CATEGORIES)
    let profiles = store.get('tendor_profiles', DEFAULT_PROFILES)
    let matches  = store.get('tendor_matches', [])
    let jobs     = store.get('tendor_jobs', [
      {id:'j1', title:'Move a sofa', category:'Moving Help', budget:80, zip:'48187', desc:'Need help moving a sofa from garage to living room.', email:'alice@example.com', phone:'', createdAt: Date.now()-100000 },
      {id:'j2', title:'Mow small yard', category:'Lawn Care', budget:40, zip:'48188', desc:'Front + back, less than an hour.', email:'bob@example.com', phone:'', createdAt: Date.now()-500000 },
      {id:'j3', title:'Fix printer', category:'Tech Help', budget:50, zip:'48187', desc:'HP printer won\'t connect to Wi‚ÄëFi.', email:'carol@example.com', phone:'', createdAt: Date.now()-900000 }
    ])
    let myAccepted = store.get('tendor_my_jobs', [])

    const $ = s=>document.querySelector(s)
    const el = (t,c,h)=>{const x=document.createElement(t); if(c)x.className=c; if(h!=null)x.innerHTML=h; return x}
    const toast = (m)=>{ const t=$('#toast'); t.textContent=m; t.style.display='block'; clearTimeout(toast._id); toast._id=setTimeout(()=>t.style.display='none',2100) }

    // ---------- ROUTING ----------
    const Screens = {
      landing: $('#screen-landing'),
      auth: $('#screen-auth'),
      role: $('#screen-role'),
      customer: $('#screen-customer'),
      worker: $('#screen-worker'),
    }

    function getUser(){ return store.get('tendor_user', null) }
    function setUser(u){ store.set('tendor_user', u); updateRoleUI(); route() }

    function route(){
      const u = getUser()
      Object.values(Screens).forEach(s=> s.classList.add('hidden'))
      if(!u){ Screens.landing.classList.remove('hidden'); Screens.landing.classList.add('active'); return }
      $('#roleBadge').textContent = u.role ? (u.role==='worker' ? 'Worker' : 'Customer') : '‚Äî'
      $('#roleBadge').classList.remove('hidden')
      if(!u.role){ Screens.role.classList.remove('hidden'); return }
      if(u.role==='worker'){ Screens.worker.classList.remove('hidden') } else { Screens.customer.classList.remove('hidden') }
    }

    // Landing CTAs
    document.getElementById('launch-app').addEventListener('click', ()=> showAuth())
    document.getElementById('cta-open-app').addEventListener('click', ()=> showAuth())
    document.getElementById('open-app-2').addEventListener('click', ()=> showAuth())
    document.getElementById('cta-browse').addEventListener('click', ()=> { setUser({}) ; route() })

    function showAuth(){ Object.values(Screens).forEach(s=> s.classList.add('hidden')); Screens.auth.classList.remove('hidden'); Screens.auth.classList.add('active') }

    // Auth tabs
    const tabs = document.querySelectorAll('.tab')
    tabs.forEach(t=> t.addEventListener('click', ()=>{
      tabs.forEach(x=> x.classList.remove('active')); t.classList.add('active')
      const m = t.dataset.tab
      document.getElementById('createForm').classList.toggle('hidden', m!=='create')
      document.getElementById('signForm').classList.toggle('hidden', m!=='signin')
    }))

    // Create / Sign in
    document.getElementById('createForm').addEventListener('submit', (e)=>{ e.preventDefault(); setUser({ email: $('#cEmail').value.trim() }) })
    document.getElementById('signForm').addEventListener('submit', (e)=>{ e.preventDefault(); const u = getUser() || {}; u.email = $('#sEmail').value.trim(); setUser(u) })

    // Role selection
    document.getElementById('chooseCustomer').addEventListener('click', ()=>{ const u=getUser()||{}; u.role='customer'; setUser(u) })
    document.getElementById('chooseWorker').addEventListener('click', ()=>{ const u=getUser()||{}; u.role='worker'; setUser(u) })

    // ----- CUSTOMER: deck -----
    function renderCategoryChips(){
      const wrap = $('#category-chips'); wrap.innerHTML=''
      const all = el('span','chip toggle active','All'); all.dataset.value='All'; wrap.append(all)
      categories.forEach(c=>{ const chip=el('span','chip toggle',c); chip.dataset.value=c; wrap.append(chip) })
      wrap.addEventListener('click', e=>{ const x=e.target.closest('.chip.toggle'); if(!x)return; wrap.querySelectorAll('.chip.toggle').forEach(c=>c.classList.remove('active')); x.classList.add('active'); rebuildDeck() })
    }

    let deckData=[]; let activeIndex=0; let dragging=null; const deckEl=$('#deck')
    const pointer = e=>({ x:e.clientX ?? (e.touches?.[0]?.clientX ?? 0), y:e.clientY ?? (e.touches?.[0]?.clientY ?? 0) })

    function buildCard(p){
      const card=el('div','tcard'); const header=el('div','card-header'); const avatar=el('div','avatar'); header.append(avatar)
      if(p.verified) header.append(el('div','badge ok','Verified')); if(p.new) header.append(el('div','badge new','New'))
      header.append(el('div','price',`$${p.rate}/hr`))
      const body=el('div','card-body'); const title=el('div','title'); title.append(el('h3','',p.name)); title.append(el('div','rating','‚òÖ '+p.rating.toFixed(1))); body.append(title)
      const meta=el('div','meta'); meta.innerHTML=`<span>${p.category}</span> <span class='dot'></span> <span>${p.distance} mi</span>`; body.append(meta)
      const skills=el('div','skills'); p.skills.slice(0,5).forEach(s=> skills.append(el('span','pill',s))); body.append(skills)
      body.append(el('p','bio',p.bio)); card.append(header,body); card.dataset.id=p.id; return card
    }

    function applyFilters(list){
      const activeChip=document.querySelector('.chip.toggle.active'); const cat=activeChip?activeChip.dataset.value:'All'; const q=$('#search').value.trim().toLowerCase()
      return list.filter(p => (cat==='All'||p.category===cat) && (q===''|| p.name.toLowerCase().includes(q)|| p.skills.some(s=>s.toLowerCase().includes(q))|| p.bio.toLowerCase().includes(q)))
    }

    function rebuildDeck(){ deckEl.innerHTML=''; deckData=applyFilters([...profiles]); activeIndex=0; if(deckData.length===0){ deckEl.append(el('div','',"<div style='padding:16px;color:#334155'>No results. Try another category or search.</div>")); return } deckData.slice(0,5).reverse().forEach(p=> deckEl.append(buildCard(p))); attachTopCard() }

    function attachTopCard(){ const current=deckEl.lastElementChild; if(!current)return; const maxRotate=18; let startX=0, startY=0, dx=0, dy=0; let dragging=false;
      const onDown=e=>{ dragging=true; const pt=pointer(e); startX=pt.x; startY=pt.y; current.setPointerCapture?.(e.pointerId) }
      const onMove=e=>{ if(!dragging)return; const pt=pointer(e); dx=pt.x-startX; dy=pt.y-startY; const rot=(dx/240)*maxRotate; current.style.transform=`translate(${dx}px, ${dy}px) rotate(${rot}deg)`; current.style.transition='transform 0s' }
      const onUp=()=>{ if(!dragging)return; dragging=false; const threshold=140; if(Math.abs(dx)>threshold){ const dir=dx>0?'right':'left'; swipe(dir) } else { current.style.transition='transform .25s'; current.style.transform='translate(0,0) rotate(0)' } }
      current.onpointerdown=onDown; current.onpointermove=onMove; current.onpointerup=onUp; current.onpointercancel=onUp; current.tabIndex=0; current.onkeydown=e=>{ if(e.key==='ArrowLeft'){ swipe('left') }; if(e.key==='ArrowRight'){ swipe('right') } }
    }

    function swipe(dir){ const card=deckEl.lastElementChild; if(!card)return; const id=card.dataset.id; const p=deckData.find(x=>x.id===id); card.style.transition='transform .35s ease'; const offX=dir==='right'?window.innerWidth:-window.innerWidth; card.style.transform=`translate(${offX}px, -40px) rotate(${dir==='right'?15:-15}deg)`; setTimeout(()=>{ card.remove(); activeIndex++; if(dir==='right') onMatch(p); if(activeIndex<deckData.length) attachTopCard(); else deckEl.innerHTML="<div style='padding:16px;color:#334155'>No more profiles ‚Äî adjust filters to see more.</div>" },260) }

    function onMatch(p){ if(!matches.find(m=>m.id===p.id)){ matches.unshift(p); store.set('tendor_matches',matches); renderMatches(); toast(`Matched with ${p.name}!`) } }

    function renderMatches(){ const box=$('#matches'); if(matches.length===0){ box.innerHTML=''; return } box.innerHTML='<h3 style="margin:8px 0">Your matches</h3>'; const list=el('div','', ''); matches.forEach(m=>{ const row=el('div','match-item',''); const left=el('div','info',''); left.append(el('div','mini')); const txt=el('div','',`<div style='font-weight:700'>${m.name} ‚Äî ${m.category}</div><div style='color:#334155'>$${m.rate}/hr ‚Ä¢ ${m.distance} mi</div>`); left.append(txt); const actions=el('div','', ''); const emailBtn=el('a','btn','Email'); emailBtn.href=`mailto:${(m.email||'hello@tendor.app')}?subject=Tendor%20booking:%20${encodeURIComponent(m.category)}`; const removeBtn=el('button','btn ghost','Remove'); removeBtn.onclick=()=>{ matches=matches.filter(x=>x.id!==m.id); store.set('tendor_matches',matches); renderMatches() }; actions.append(emailBtn,removeBtn); row.append(left,actions); list.append(row) }); box.append(list) }

    // Worker board
    function renderJobBoard(){ const board=$('#jobBoard'); board.innerHTML=''; if(jobs.length===0){ board.innerHTML='<div style="color:#334155">No jobs yet. Check back later.</div>'; return } jobs.forEach(j=>{ const row=el('div','job',''); const left=el('div','',`<h4>${j.title}</h4><div style='color:#334155'>${j.category} ‚Ä¢ $${j.budget} ‚Ä¢ ${j.zip}</div><div style='color:#64748b'>${j.desc}</div>`); const actions=el('div','', ''); const accept=el('button','btn primary','Accept'); accept.onclick=()=>{ acceptJob(j) }; actions.append(accept); row.append(left,actions); board.append(row) }) }
    function renderMyJobs(){ const list=$('#myJobs'); list.innerHTML=''; if(myAccepted.length===0){ list.innerHTML='<div style="color:#334155">No accepted jobs yet.</div>'; return } myAccepted.forEach(j=>{ const row=el('div','job',''); const left=el('div','',`<h4>${j.title}</h4><div style='color:#334155'>${j.category} ‚Ä¢ $${j.budget} ‚Ä¢ ${j.zip}</div><div style='color:#64748b'>${j.desc}</div>`); const actions=el('div','', ''); const done=el('button','btn','Mark done'); done.onclick=()=>{ myAccepted=myAccepted.filter(x=>x.id!==j.id); store.set('tendor_my_jobs',myAccepted); renderMyJobs(); toast('Job marked done') }; actions.append(done); row.append(left,actions); list.append(row) }) }
    function acceptJob(j){ if(!myAccepted.find(x=>x.id===j.id)){ myAccepted.unshift(j); store.set('tendor_my_jobs',myAccepted); renderMyJobs(); toast('Job accepted!') } }

    // Category selects & modals (reuse)
    function fillCategorySelects(){ const options=['<option value="" disabled selected>Select</option>', ...categories.map(c=>`<option>${c}</option>`)].join(''); document.getElementById('jobCategory').innerHTML=options; document.getElementById('proCategory').innerHTML=options }
    function openModal(id){ const m=document.querySelector(id); m.style.display='flex' }
    function closeModal(e){ e?.preventDefault?.(); document.querySelectorAll('.modal-backdrop').forEach(m=> m.style.display='none') }
    function setupModals(){ [['#open-post','#post-modal'],['#open-join','#join-modal'],['#open-join-2','#join-modal']].forEach(([btn,modal])=> document.querySelector(btn)?.addEventListener('click',()=> openModal(modal))); document.querySelectorAll('[data-close]')?.forEach(b=> b.addEventListener('click', closeModal)); document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeModal() }) }

    // Init
    document.getElementById('year').textContent = new Date().getFullYear()
    document.addEventListener('click', (e)=>{ if(e.target.id==='btn-no') swipe('left'); if(e.target.id==='btn-yes') swipe('right') })
    document.getElementById('search')?.addEventListener('input', ()=> rebuildDeck())

    fillCategorySelects(); setupModals(); renderCategoryChips(); rebuildDeck(); renderMatches(); renderJobBoard(); renderMyJobs();
    route();

    // PWA: register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', ()=> navigator.serviceWorker.register('/sw.js').catch(console.error))
    }
  </script>
</body>
</html>
